#!/usr/bin/env bash
# .mux/tool_post - Format TypeScript and Markdown files after edits

if [[ "$MUX_TOOL" == file_edit_* ]]; then
  file=$(echo "$MUX_TOOL_INPUT" | jq -r '.file_path')

  case "$file" in
    *.ts|*.tsx)
      before=$(cat "$file" 2>/dev/null) || exit 0
      # 1. Format with prettier
      bun run prettier --write --log-level silent "$file" 2>/dev/null || true
      # 2. Fix tailwind class ordering (minimal config for speed)
      bun run eslint --fix --quiet --no-config-lookup --no-inline-config --config .mux/eslint-tailwind-only.mjs "$file" 2>/dev/null || true
      # Only output if file changed
      if [[ "$(cat "$file")" != "$before" ]]; then
        echo "Formatted: $file"
      fi
      ;;
    *.md|*.mdx)
      before=$(cat "$file" 2>/dev/null) || exit 0
      bun run prettier --write --log-level silent "$file" 2>/dev/null || true
      if [[ "$(cat "$file")" != "$before" ]]; then
        echo "Formatted: $file"
      fi
      ;;
  esac
fi
